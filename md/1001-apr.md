
```
# Automated Program Repair (APR)

**개요**

Automated Program Repair (APR)은 소스 코드의 결함을 자동으로 탐지하고, 수정 패치를 생성하며, 이를 검증해 코드베이스에 병합하는 일련의 기술과 절차입니다. APR은 개발자의 디버깅 부담을 줄이고 소프트웨어 신뢰성을 향상시키는 것을 목표로 합니다.

---

## APR 기본 파이프라인

1. **오류 탐지 (Error detection)**
   - 테스트 실패나 런타임 오류를 통해 결함을 발견합니다.

2. **오류 위치 식별 (Fault localization)**
   - 결함이 의심되는 코드 줄을 좁혀냅니다. 예: 조건문 분기, null 체크 등. 일반적으로 상위 5개 정도의 후보 라인을 추출합니다.

3. **패치 생성 (Patch generation)**
   - 각 후보 라인에 대해 여러 패치 후보를 자동 생성합니다. 예: 라인당 50개의 후보를 생성하는 식으로 탐색합니다.

4. **패치 검증 (Patch validation)**
   - 전체 테스트를 다시 실행해 패치가 통과하는지 확인합니다. 통과하는 후보를 "plausible patch"라 부릅니다.

5. **패치 선택 및 병합 (Patch selection & merge)**
   - 품질 점수(예: 테스트 커버리지, 패치 크기, 정적 분석 결과 등)를 비교해 최종 패치를 선택하고 코드베이스에 병합합니다.

---

## LLM을 이용한 취약점 탐지 (Vulnerability Localization, VL)

- LLM 기반 접근법은 코드의 문맥을 이해해 취약한 위치를 찾아내는 데 활용됩니다.
- **문제점**:
  - 코드 줄 수(LoC)가 증가할수록 정확도가 떨어지는 경향이 있습니다.
  - 앞뒤 문맥은 잘 기억해도 중간 부분을 놓치는 "lost-in-the-middle" 현상이 발생할 수 있습니다.
  - 주석이나 불필요한 코드가 노이즈가 되어 환각(hallucination)을 일으킬 수 있습니다.
  - 다양한 프로그래밍 언어와 패턴을 학습하기 위한 데이터가 부족할 수 있습니다.

---

## 보안 패치 생성 기법 (Security Patch Generation, SPG)

1. **템플릿 기반 (Template-based)**
   - 예: PAR 기법. 미리 정의한 코드 템플릿을 이용해 사용자 입력이 들어가는 부분을 안전하게 대체합니다.

2. **유전 알고리즘 기반 (Genetic algorithms)**
   - 예: GenProg. 패치를 개체로 보고 진화적 탐색을 통해 점점 더 나은 후보를 찾아냅니다. 무작위 탐색 대신 자연선택과 유사한 방식으로 최적화를 수행합니다.

3. **LLM 기반 (LLM-based, e.g., Codex)**
   - 코드 생성 능력을 가진 대형언어모델(예: Codex, GPT 계열)을 이용해 패치를 생성합니다. APR 도구와 결합해 더 정교한 수정을 시도할 수 있습니다.

---

## 추가 설명 및 한계

- APR은 많은 경우에 작은 코드 변경으로도 문제를 해결할 수 있지만, 모든 버그를 자동으로 정확히 고치지는 못합니다.
- 패치가 통과하는 것이 항상 올바른 수정을 의미하지 않으므로(일시적 회피 등), 추가적인 정적/동적 검증이 필요합니다.
- LLM 기반 접근은 빠르게 발전하고 있으나, 맥락 길이, 노이즈, 언어 다양성 등 현실적인 제약을 염두에 두어야 합니다.

---

## 참고(References)

- PAR (template-based approaches)
- GenProg (유전 알고리즘 기반 APR)
- Codex / LLM 기반 APR 연구
- "Attention Is All You Need for LLM-based Code Vulnerability Localization" (LOVA) — LLM의 self-attention을 활용한 취약점 위치 탐지 연구
- 최근 USENIX Security '25 관련 논문들(LLM 기반 보안 패치/취약점 탐지 사례)
```